machine:
  python:
    version: 3.4.3
  node:
    version: 0.12.2
  environment:
    DJANGO_SETTINGS_MODULES: edwin.settings
    DJANGO_CONFIGURATION: Test
    DATABASE_URL: postgres://ubuntu:@127.0.0.1:5432/circle_test

dependencies:
  post:
    - python manage.py collectstatic --noinput

database:
  override:
    - python manage.py migrate

test:
  override:
    - python manage.py test
    - npm test

deployment:
  dev:
    owner: mythmon
    branch: circleci
    commands:
      - heroku plugins:install heroku-docker
      - heroku maintenance:on --app edwin-dev
      - heroku docker:release --app edwin-dev
      - heroku run --app edwin-dev python manage.py migrate
      - heroku maintenance:off --app edwin-dev
